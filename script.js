// translations.js - يوضع في بداية ملف script.js
const translations = {
    ar: {
        // Navbar
        navHome: "الرئيسية",
        navAbout: "عني",
        navSkills: "المهارات",
        navProjects: "مشاريعي",
        navRecommendations: "توصيات",

        // About Section
        aboutTitle: "نبذة عني",
        aboutParagraph1: "أنا راشد الهاشمي، ضابط شكاوى حكومي أول في شركة طاقة للتوزيع. أحمل درجة البكالوريوس في الهندسة المدنية وشهادات في حل المشكلات الإبداعي وأدوات Six Sigma. تتجلى خبرتي في تحليل البيانات لتحديد الأسباب الجذرية وحل الشكاوى بناءً على البيانات، بالإضافة إلى خبرتي في قيادة الفريق وخدمة العملاء، مما يعكس التزامًا قويًا بالتميز التشغيلي ورضا العملاء. حالياً، أعمل على توسيع معرفتي في الذكاء الاصطناعي من خلال دورات متقدمة في 'الذكاء الاصطناعي التوليدي: أساسيات هندسة الأوامر' و 'الذكاء الاصطناعي التوليدي: مقدمة وتطبيقات' من IBM على Coursera. هذا التعلم المستمر يعزز قدرتي على تطبيق نهج مبتكرة تعتمد على البيانات لتحسين جودة الخدمة ودعم العملاء.",

        // Skills Section
        skillsTitle: "المهارات",
        techSkillsTitle: "المهارات التقنية",
        skillDataAnalysis: "تحليل البيانات",
        skillProblemSolving: "حل المشكلات",
        skillSixSigma: "أدوات Six Sigma",
        skillCivilEng: "مبادئ الهندسة المدنية",
        skillPromptEng: "هندسة الأوامر (الذكاء الاصطناعي)",
        skillAIAp: "تطبيقات الذكاء الاصطناعي",
        softSkillsTitle: "المهارات الشخصية والإدارية",
        skillTeamLeadership: "قيادة الفريق",
        skillCustomerService: "خدمة العملاء المباشرة",
        skillCommunication: "التواصل الفعال",
        skillOperationalExcellence: "التميز التشغيلي",
        skillComplaintManagement: "إدارة الشكاوى",
        skillStrategicThinking: "التفكير الاستراتيجي",

        // Projects Section
        projectsTitle: "مشاريعي",
        projectCivilTitle: "مشاريع الهندسة المدنية",
        projectCivilDesc: "شاركت في مشروعين متميزين: 'مشروع تسوية وإزالة الرمال في الرويز' (شهرين) و 'مشروع بناء أساسات فيلا' من البداية حتى النهاية، مع تطبيق أفضل الممارسات الهندسية في كليهما.",
        projectComplaintToolTitle: "أداة تصفية وتلخيص الشكاوى",
        projectComplaintToolDesc: "تصميم وتطوير صفحة ويب لفلترة وتلخيص الطلبات والشكاوى بكفاءة، مما يتيح مراجعة مبسطة وتسجيل أرقام الحالات لتحسين المتابعة.",
        projectCustomerSatTitle: "مبادرة تحسين رضا العملاء",
        projectCustomerSatDesc: "مشروع يركز على تحليل بيانات الشكاوى لتحديد نقاط الضعف وتعزيز مؤشرات الأداء الرئيسية لرضا العملاء، مما أدى إلى رفع مستوى جودة الخدمة ودعم العملاء.",

        // Recommendations Section
        recommendationsTitle: "توصيات",
        leaveRecTitle: "اترك توصية",
        formName: "اسمك:",
        formNamePlaceholder: "أدخل اسمك هنا",
        formTitleOrg: "لقبك/شركتك (اختياري):",
        formTitleOrgPlaceholder: "أدخل لقبك أو شركتك",
        formRecommendation: "توصيتك:",
        formRecPlaceholder: "اكتب توصيتك هنا",
        formSubmitBtn: "إرسال التوصية",

        // Alert Messages
        alertFillForm: "الرجاء تعبئة اسمك ونص التوصية.",
        alertSuccess: "شكراً لتوصيتك! تم إضافتها بنجاح وهي الآن متاحة!",
        alertFailedAdd: "فشل إضافة التوصية. الرجاء التحقق من اتصال الإنترنت لديك أو المحاولة لاحقاً.",
        alertFailedLoad: "فشل تحميل التوصيات. الرجاء التحقق من مشغل المتصفح للحصول على تفاصيل الخطأ.",
    },
    en: {
        // Navbar
        navHome: "Home",
        navAbout: "About",
        navSkills: "Skills",
        navProjects: "Projects",
        navRecommendations: "Recommendations",

        // About Section
        aboutTitle: "About Me",
        aboutParagraph1: "I am Rashed Alhashmi, a Senior AD Government Complaint Officer at TAQA Distribution. With a Bachelor's in Civil Engineering and certifications in Creative Problem Solving and Six Sigma Tools, I specialize in analyzing complex datasets to identify root causes and deliver data-driven resolutions for complaints. My experience also includes team leadership and direct customer service, reflecting a strong commitment to operational excellence and customer satisfaction. Currently, I am expanding my expertise in Artificial Intelligence by completing advanced courses in 'Generative AI: Prompt Engineering Basics' and 'Generative AI: Introduction and Applications' through IBM on Coursera. This continuous learning enhances my ability to apply innovative, data-driven approaches to improve service quality and customer support.",

        // Skills Section
        skillsTitle: "Skills",
        techSkillsTitle: "Technical Skills",
        skillDataAnalysis: "Data Analysis",
        skillProblemSolving: "Problem Solving",
        skillSixSigma: "Six Sigma Tools",
        skillCivilEng: "Civil Engineering Principles",
        skillPromptEng: "Prompt Engineering (AI)",
        skillAIAp: "AI Applications",
        softSkillsTitle: "Soft Skills & Management",
        skillTeamLeadership: "Team Leadership",
        skillCustomerService: "Direct Customer Service",
        skillCommunication: "Effective Communication",
        skillOperationalExcellence: "Operational Excellence",
        skillComplaintManagement: "Complaint Management",
        skillStrategicThinking: "Strategic Thinking",

        // Projects Section
        projectsTitle: "My Projects",
        projectCivilTitle: "Civil Engineering Projects",
        projectCivilDesc: "Involved in two distinct projects: 'Razeen Sand Leveling and Removal Project' (2 months) and 'Villa Foundation Construction Project' from start to finish, applying best engineering practices in both.",
        projectComplaintToolTitle: "Complaint Filtering & Summarization Tool",
        projectComplaintToolDesc: "Designed and developed a web page for efficient filtering and summarization of requests and complaints, enabling streamlined review and logging of case numbers for improved follow-up.",
        projectCustomerSatTitle: "Customer Satisfaction Improvement Initiative",
        projectCustomerSatDesc: "A project focused on analyzing complaint data to identify weaknesses and enhance customer satisfaction KPIs, resulting in an uplifted level of service quality and customer support.",

        // Recommendations Section
        recommendationsTitle: "Recommendations",
        leaveRecTitle: "Leave a Recommendation",
        formName: "Your Name:",
        formNamePlaceholder: "Enter your name here",
        formTitleOrg: "Your Title/Company (Optional):",
        formTitleOrgPlaceholder: "Enter your title or company",
        formRecommendation: "Your Recommendation:",
        formRecPlaceholder: "Write your recommendation here",
        formSubmitBtn: "Submit Recommendation",

        // Alert Messages
        alertFillForm: "Please fill in your name and recommendation text.",
        alertSuccess: "Thank you for your recommendation! It has been added successfully and is now live!",
        alertFailedAdd: "Failed to add recommendation. Please check your internet connection or try again later.",
        alertFailedLoad: "Failed to load recommendations. Please check browser console for error details.",
    }
};

let currentLanguage = 'ar'; // اللغة الافتراضية عند تحميل الصفحة

function applyTranslation(lang) {
    document.querySelectorAll('[data-key]').forEach(element => {
        const key = element.getAttribute('data-key');
        if (translations[lang] && translations[lang][key]) {
            // If the element has a placeholder attribute
            if (element.placeholder !== undefined) {
                element.placeholder = translations[lang][key];
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });

    // تحديث اتجاه الصفحة (للعربية من اليمين لليسار، وللإنجليزية من اليسار لليمين)
    const body = document.body;
    if (lang === 'ar') {
        body.style.direction = 'rtl';
        body.classList.add('lang-ar');
        body.classList.remove('lang-en');
    } else {
        body.style.direction = 'ltr';
        body.classList.add('lang-en');
        body.classList.remove('lang-ar');
    }
    
    // حفظ اللغة المفضلة للمستخدم في localStorage
    localStorage.setItem('preferredLang', lang);
    currentLanguage = lang; // تحديث اللغة الحالية في المتغير
    
    // تحديث حالة أزرار اللغة (active)
    const langArBtn = document.getElementById('lang-ar');
    const langEnBtn = document.getElementById('lang-en');
    if (langArBtn && langEnBtn) {
        if (lang === 'ar') {
            langArBtn.classList.add('active');
            langEnBtn.classList.remove('active');
        } else {
            langEnBtn.classList.add('active');
            langArBtn.classList.remove('active');
        }
    }
}

// تعديل الدالة showCustomAlert لاستخدام الترجمة
function showCustomAlert(key, fallbackMessage = '') {
    const message = translations[currentLanguage][key] || fallbackMessage;
    const customAlert = document.getElementById('custom-alert');
    const alertMessage = document.getElementById('alert-message');
    
    if (customAlert && alertMessage) {
        alertMessage.textContent = message;
        customAlert.style.display = 'flex';
    } else {
        console.error('Custom alert elements not found. Falling back to default alert.');
        alert(message);
    }
}

// 1. إعدادات Firebase الخاصة بك (استبدل بالمعلومات الحقيقية التي نسختها من لوحة تحكم Firebase)
const firebaseConfig = {
    apiKey: "AIzaSyDHUK8CG8FcJ-GJfvoP0NkosPfd1iFHugw", // تأكد من أن هذا المفتاح صحيح تماماً
    authDomain: "my-personal-project-25.firebaseapp.com",
    projectId: "my-personal-project-25",
    storageBucket: "my-personal-project-25.firebasestorage.app",
    messagingSenderId: "121788883138",
    appId: "1:121788883138:web:dcac92ffbba06a10eb9b5b",
    // measurementId: "G-PCF78XM5W5" // measurementId ليس ضرورياً لـ firestore، يمكن إزالته
};
// 2. تهيئة Firebase
firebase.initializeApp(firebaseConfig);
// 3. الحصول على مرجع لقاعدة بيانات Firestore
const db = firebase.firestore();

// بداية كود DOMContentLoaded الخاص بك:
document.addEventListener('DOMContentLoaded', function() {
    // حاول تحميل اللغة المفضلة من localStorage عند تحميل الصفحة لأول مرة
    const savedLang = localStorage.getItem('preferredLang');
    if (savedLang) {
        currentLanguage = savedLang;
    }
    
    // طبق الترجمة الافتراضية أو المحفوظة عند تحميل الصفحة
    applyTranslation(currentLanguage);

    const langArBtn = document.getElementById('lang-ar');
    const langEnBtn = document.getElementById('lang-en');

    if (langArBtn && langEnBtn) {
        langArBtn.addEventListener('click', () => applyTranslation('ar'));
        langEnBtn.addEventListener('click', () => applyTranslation('en'));
    }

    // هنا يبدأ كود Firebase الحالي الخاص بك
    const recommendationsContainer = document.querySelector('.recommendations-container');
    const recommendationForm = document.getElementById('recommendationForm');
    
    const customAlert = document.getElementById('custom-alert');
    const alertMessage = document.getElementById('alert-message');
    const closeButton = document.querySelector('#custom-alert .close-button');
    const alertOkButton = document.getElementById('alert-ok-button');

    // وظيفة لإخفاء التنبيه المخصصة
    function hideCustomAlert() {
        if (customAlert) {
            customAlert.style.display = 'none';
        }
    }
    
    if (closeButton) closeButton.addEventListener('click', hideCustomAlert);
    if (alertOkButton) alertOkButton.addEventListener('click', hideCustomAlert);
    if (customAlert) {
        customAlert.addEventListener('click', function(event) {
            if (event.target === customAlert) {
                hideCustomAlert(); // إغلاق عند النقر خارج المحتوى
            }
        });
    }

    function createRecommendationCard(name, title, text) {
        const card = document.createElement('div');
        card.classList.add('recommendation-card');
        const recommendationText = document.createElement('p');
        recommendationText.textContent = `"${text}"`;
        recommendationText.style.fontStyle = 'italic';
        const recommenderName = document.createElement('h4');
        recommenderName.textContent = name;
        const recommenderTitle = document.createElement('p');
        recommenderTitle.classList.add('recommender-title');
        recommenderTitle.textContent = title ? title : 'Anonymous';
        card.appendChild(recommendationText);
        card.appendChild(recommenderName);
        card.appendChild(recommenderTitle);
        return card;
    }

    async function fetchRecommendations(showErrorAlert = true) {
        recommendationsContainer.innerHTML = '';
        try {
            const snapshot = await db.collection('recommendations').orderBy('timestamp', 'desc').get();
            if (snapshot.empty) {
                console.log("No recommendations found in Firestore.");
            }
            snapshot.forEach(doc => {
                const data = doc.data();
                const card = createRecommendationCard(data.name, data.title, data.text);
                recommendationsContainer.appendChild(card);
            });
        } catch (error) {
            console.error("Error fetching recommendations: ", error);
            if (showErrorAlert) {
                showCustomAlert('alertFailedLoad');
            }
        }
    }

    recommendationForm.addEventListener('submit', async function(event) {
        event.preventDefault();
        const name = document.getElementById('recommender-name').value;
        const title = document.getElementById('recommender-title-org').value;
        const text = document.getElementById('recommendation-text').value;
        if (name.trim() === '' || text.trim() === '') {
            showCustomAlert('alertFillForm');
            return;
        }
        try {
            await db.collection('recommendations').add({
                name: name,
                title: title,
                text: text,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            recommendationForm.reset();
            await fetchRecommendations(false);
            showCustomAlert('alertSuccess');
        } catch (error) {
            console.error("Error adding document: ", error);
            showCustomAlert('alertFailedAdd', 'Error: ' + error.message);
        }
    });

    fetchRecommendations(false);
});
